{{ template "header_default" . }}
<div class="container">
    <h3>Overview of all issuers</h3>

    {{ if .Error }}
        {{ template "error_alert" .Error }}
    {{ end }}
    {{ if .Success }}
        {{ template "success_alert" .Success }}
    {{ end }}
    {{ if .Info }}
        {{ template "info_alert" .Info }}
    {{ end }}

    <div class="row">
        <div class="col-md-12">
            <!-- form to create new issuer. select key algo, subject data, and optionally parent issuer -->
            <form method="post" class="">
                 <!-- select parent issuer -->
                <div class="form-group mb-2">
                    <label for="parent_issuer">Parent Issuer (optional)</label>
                    <select class="form-control" id="parent_issuer" name="parent_issuer" onchange="checkMode();">
                        <option value="">None</option>
                        {{ range .Issuers }}
                            <option value="{{ .ID }}">{{ .Subject }}</option>
                        {{ end }}
                    </select>
                </div>
                <!-- key algorithm -->
                <div class="form-group mb-2">
                    <label for="key_algorithm">Key Algorithm</label>
                    <select class="form-control" id="key_algorithm" name="key_algorithm">
                        <option value="RSA">RSA</option>
                        <option value="ECDSA">ECDSA</option>
                        <option value="ED25519">ED25519</option>
                    </select>
                </div>  
                <!-- bit length for key 256, 382, 521 for ecdsa, ignored for ed25519, >1024 for rsa -->
                <div class="form-group mb-4">
                    <label for="key_length">Key Length</label>
                    <input type="number" class="form-control" id="key_length" name="key_length">
                </div>

                <!-- storage location (local filesystem or database) -->
                <div class="form-group mb-4">
                    <label for="storage_location">Storage Location</label>
                    <select class="form-control" id="storage_location" name="storage_location">
                        <option value="local_filesystem">Local Filesystem</option>
                        <option value="local_database">Local Database</option>
                    </select>
                </div>

                <!-- validity in years -->
                <div class="form-group mb-4">
                    <label for="validity_years">Validity (years)</label>
                    <input type="number" class="form-control" id="validity_years" name="validity_years" value="10" required>
                </div>

                <!-- subject data, divided into their separate fields -->
                <div class="form-group mb-2">
                    <label for="subject_common_name">Common Name</label>
                    <input type="text" class="form-control" id="subject_common_name" name="subject_common_name">
                </div>
                <div class="form-group mb-2">
                    <label for="subject_organization">Organization</label>
                    <input type="text" class="form-control" id="subject_organization" name="subject_organization">
                </div>
                <div class="form-group mb-2">
                    <label for="subject_organizational_unit">Organizational Unit</label>
                    <input type="text" class="form-control" id="subject_organizational_unit" name="subject_organizational_unit">
                </div>
                <div class="form-group mb-2">
                    <label for="subject_locality">Locality</label>
                    <input type="text" class="form-control" id="subject_locality" name="subject_locality">
                </div>
                <div class="form-group mb-2">
                    <label for="subject_country">Country</label>
                    <input type="text" class="form-control" id="subject_country" name="subject_country" required>
                </div>
                <div class="form-group mb-2">
                    <label for="subject_province">Province</label>
                    <input type="text" class="form-control" id="subject_province" name="subject_province">  
                </div>
                <div class="form-group mb-2">
                    <label for="subject_street_address">Street Address</label>
                    <input type="text" class="form-control" id="subject_street_address" name="subject_street_address">
                </div>

                <button type="submit" class="btn btn-primary">Create Issuer</button>

            </form>

        </div>  
    </div>

</div>

<script>
    function checkMode() {
        var parentIssuer = document.getElementById("parent_issuer").value;
        var keyAlgo = document.getElementById("key_algo");
        var keyLength = document.getElementById("key_length");

        if (parentIssuer) {
            // if parent issuer is selected, disable key algo and key length
            keyAlgo.disabled = true;
            keyLength.disabled = true;
        } else {
            // else enable them
            keyAlgo.disabled = false;
            keyLength.disabled = false;
        }
    }
</script>

{{ template "footer_default" . }}